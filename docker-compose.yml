services:
  go2rtc:
    image: alexxit/go2rtc:latest
    restart: unless-stopped
    ports:
      - "1985:1984"             # host:container (web/api UI)
      - "8557:8554"             # RTSP
      - "8556:8555/tcp"         # WebRTC TCP
      - "8556:8555/udp"         # WebRTC UDP
    volumes:
      - ./go2rtc.yaml:/config/go2rtc.yaml:ro
    env_file:
      - ./.env
    environment:
      - TZ=${TZ}

  ptz-api:
    build:
      context: ./ptz-api
      dockerfile: Dockerfile

    restart: unless-stopped
    ports:
      - "8089:8088"             # host:container
    env_file:
      - ./.env
    environment:
      # Explicitly pass only what the app uses (all come from .env)
      - API_HOST=${API_HOST}
      - API_PORT=${API_PORT}
      - CAM1_HOST=${CAM1_HOST}
      - CAM1_PORT=${CAM1_PORT}
      - CAM1_USER=${CAM1_USER}
      - CAM1_PASS=${CAM1_PASS}
      - CAM1_PROFILE_TOKEN=${CAM1_PROFILE_TOKEN}
      - CAM2_HOST=${CAM2_HOST}
      - CAM2_PORT=${CAM2_PORT}
      - CAM2_USER=${CAM2_USER}
      - CAM2_PASS=${CAM2_PASS}
      - CAM2_PROFILE_TOKEN=${CAM2_PROFILE_TOKEN}
      - CORS_ORIGINS=${CORS_ORIGINS}

  ui:
    image: nginx:alpine
    restart: unless-stopped
    ports:
      - "80:80"
    volumes:
      - ./:/usr/share/nginx/html:ro

